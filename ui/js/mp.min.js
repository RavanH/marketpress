String.prototype.escapeSelector=function(){return this.replace(/(:|\.|\[|\])/g,"\\$1")};var mp_cart={};!function($){mp_cart.productFormValidationArgs={errorClass:"mp_form_input_error",errorElement:"span",errorPlacement:function(error,element){error.appendTo(element.closest(".mp_product_options_att").find(".mp_product_options_att_label"))},ignore:"",submitHandler:function(form){var item,$form=$(form),qty=$form.find('[name="product_quantity"]').val(),product_id=$form.find('[name="product_id"]').val();$form.find('[name^="product_attr_"]').length>0?(item={},item.product_id=product_id,$form.find('[name^="product_attr_"]').each(function(){var $this=$(this);item[$this.attr("name")]=$this.val()})):item=product_id,marketpress.loadingOverlay("show"),mp_cart.addItem($form,item,qty)}},mp_cart.init=function(){this.initCartAnimation(),this.initCartListeners()},mp_cart.initProductListListeners=function(){$("#mp-products, .mp-multiple-products").on("submit",".mp_form-buy-product",function(e){e.preventDefault(),$(".mp_ajax_loader").remove();var $this=$(this);$this.on("mp_cart/before_add_item",function(e,item,qty){$this.addClass("invisible"),$(".mp_ajax_loader").length||$(mp_cart_i18n.ajax_loader).insertAfter($this).show()}),$this.on("mp_cart/after_add_item",function(e,resp,item,qty){$this.removeClass("invisible"),$(".mp_ajax_loader").remove()}),mp_cart.addItem($this,$this.find('[name="product_id"]').val())})},mp_cart.initCartButtonListeners=function(){$(".mp_button-widget-cart-empty").on("click",function(e){e.preventDefault(),mp_cart.emptyCart()})},mp_cart.initShortcodeProductListeners=function(){var me=this;$(".mp-shortcode-wrap").on("change",'[name^="product_attr_"]',this.updateProductAttributes),$(".mp-shortcode-wrap").find(".mp_buy_button").each(function(){$(this).on("mp_cart/before_add_item",function(e,item,qty){marketpress.loadingOverlay("show")}).on("mp_cart/after_add_item",function(e,resp,item,qty){marketpress.loadingOverlay("hide")}).validate(me.productFormValidationArgs)})},mp_cart.initSingleProductListeners=function(){var me=this;$(".mp-single-product").each(function(){$(this).on("change",'[name^="product_attr_"]',me.updateProductAttributes),$(this).on("input",'[name^="product_quantity"]',me.checkProductQuantity),$(this).find(".mp_form-buy-product").not(".mp_no_single, .mp_buy_button").on("mp_cart/before_add_item",function(e,item,qty){marketpress.loadingOverlay("show")}).on("mp_cart/after_add_item",function(e,resp,item,qty){marketpress.loadingOverlay("hide")}).validate(me.productFormValidationArgs),$(this).find(".mp_no_single").not(".mp_buy_button").each(function(){$(this).on("mp_cart/before_add_item",function(e,item,qty){marketpress.loadingOverlay("show")}).on("mp_cart/after_add_item",function(e,resp,item,qty){marketpress.loadingOverlay("hide")}).validate(me.productFormValidationArgs)})})},mp_cart.initCartFormListeners=function(){$("#mp-cart-form").on("change",'select[name^="mp_cart_item-qty"]',function(e){var $this=$(this),itemId=$this.attr("name").match(/[0-9]+/gi),qty=$(this).val();mp_cart.updateItemQty(itemId[0],qty,$("#mp-cart-form"))})},mp_cart.initCartListeners=function(){mp_cart.initProductListListeners(),mp_cart.initSingleProductListeners(),mp_cart.initShortcodeProductListeners(),mp_cart.initCartFormListeners(),mp_cart.initProductOptionsLightbox(),mp_cart.initCartButtonListeners()},mp_cart.initCboxListeners=function(){$("#mp-product-options-callout-form").on("mp_cart/after_add_item",function(e,resp){resp.success&&$.colorbox.close()}).validate(this.productFormValidationArgs),$("#cboxLoadedContent").on("change",'[name^="product_attr_"]',this.updateProductAttributes)},mp_cart.updateProductAttributes=function(){var $this=$(this);$('[name^="product_attr_"]').each(function(i,obj){if(""==$(this).val()){var attr_name=$(this).attr("name");$('[name^="'+attr_name+'"] option:nth-child(2)').attr("selected",!0)}}),$form=$this.closest("form"),$container=$("#colorbox").is(":visible")?$form:$this.closest(".mp-single-product"),$meta_container=$this.closest(".mp_product"),$qtyChanged=$form.find('input[name="product_qty_changed"]'),url=mp_cart_i18n.ajaxurl+"?action=mp_product_update_attributes",marketpress.loadingOverlay("show");var form_data=$form.serializeArray();$this.parents(".mp_product_options_att").siblings(".mp_product_options_att").find('[name^="product_attr_"]').each(function(i,el){$(form_data).each(function(j,el2){el2.name===$(el).attr("name")&&(form_data[j].name="other_"+form_data[j].name)})}),$.post(url,jQuery.param(form_data)).done(function(resp){marketpress.loadingOverlay("hide"),marketpress.ajaxEvent("mp_cart/after_update_product_attributes",resp),resp.success&&(resp.data.image?0==$container.find(".mp_product_image_link").size()?($(".mp_single_product_images").html($("<a/>").attr({"class":"mp_product_image_link mp_lightbox cboxElement",rel:"lightbox enclosure",href:resp.data.image_full}).html($("<img/>").attr({"class":"mp_product_image_single photo",src:resp.data.image}))),$(".mp_product_image_link").filter(".mp_lightbox").colorbox({maxWidth:"90%",maxHeight:"90%",close:"&times;"}),$(".mp_product_options_thumb").attr("src",resp.data.image)):($container.find(".mp_product_image_single").attr("src",resp.data.image),$container.find(".mp_product_image_link").attr("href",resp.data.image_full)):$(".mp_product_image_link").remove(),$container.find(".mp_product_tab_content_text").html(resp.data.description),$(".mp_product_options_excerpt").size()>0&&$(".mp_product_options_excerpt").html(resp.data.excerpt),$meta_container.find(".mp_product_excerpt").html(resp.data.excerpt),resp.data.price&&$container.find(".mp_product_price").replaceWith(resp.data.price),resp.data.product_input&&($container.find("#mp_product_options_att_quantity-error").remove(),$container.find("#mp_product_options_att_quantity").replaceWith(resp.data.product_input),"undefined"!=typeof resp.data.in_stock&&$container.find("#mp_product_options_att_quantity").trigger("blur")),$.each(resp.data,function(index,value){var $elm=$("#mp_"+index);"qty_in_stock"!=index&&"out_of_stock"!=index&&0!=$elm.length&&$elm.html(value)}),resp.data.out_of_stock&&(alert(resp.data.out_of_stock),$form.find('input[name="product_quantity"]').val(resp.data.qty_in_stock)),$('[name^="product_attr_"].mp_select2').mp_select2({dropdownCssClass:"mp_select2",dropdownAutoWidth:1,minimumResultsForSearch:-1}),$('[name^="product_attr_"].mp_select2_search').mp_select2({dropdownCssClass:"mp_select2",dropdownAutoWidth:1}),$.colorbox.resize())})},mp_cart.checkProductQuantity=function(){var $this=$(this);$this.attr("max")>0&&parseInt($this.val())>parseInt($this.attr("max"))&&($this.trigger("blur"),setTimeout(function(){$this.val($this.attr("max"))},50))},mp_cart.initProductOptionsLightbox=function(){$(".mp_link-buynow").filter(".mp_button-has_variations").colorbox({close:"x",href:function(){return $(this).attr("data-href")},overlayClose:!1,trapFocus:!1,width:300,overlayClose:!0,escKey:!0,onLoad:function(){$("#colorbox").removeAttr("tabindex")},onComplete:function(){$("select.mp_select2").mp_select2({dropdownCssClass:"mp_select2",dropdownAutoWidth:1,minimumResultsForSearch:-1})}})},mp_cart.addItem=function($form,item,qty){return void 0===item||"object"!=typeof $form?!1:(void 0===qty&&(qty=1),$form.trigger("mp_cart/before_add_item",[item,qty]),void $.ajaxq("addtocart",{data:{product:item,qty:qty,cart_action:"add_item",is_cart_page:mp_cart_i18n.is_cart_page},type:"POST",url:$form.attr("data-ajax-url")}).done(function(resp){marketpress.ajaxEvent("mp_cart/after_add_item",resp,$form);var buttonType=$form.find('[type="submit"]').attr("name");if(resp.success){if(resp.data.cart_updated===!1&&alert(mp_cart_i18n.cart_updated_error_limit),"buynow"==buttonType)return void(window.location.href=$form.attr("action"));mp_cart.update(resp.data.minicart),mp_cart.update_widget(resp.data.widgetcart),mp_cart.update_product_input(resp.data.product_input,$form),mp_cart.update_product_buttons(resp.data.out_of_stock,$form),mp_cart.initCartButtonListeners(),$form.get(0).reset(),setTimeout(function(){$("#mp-floating-cart").trigger("click"),setTimeout(function(){$("#mp-floating-cart").removeClass("visible in-transition")},3e3)},100)}$(window).trigger("resize")}))},mp_cart.removeItem=function(itemId){if(void 0===itemId)return!1;itemId=itemId.toString();var url=mp_cart_i18n.ajaxurl+"?action=mp_update_cart",data={product:itemId,cart_action:"remove_item",is_cart_page:mp_cart_i18n.is_cart_page};marketpress.loadingOverlay("show"),$.post(url,data).done(function(resp){if(resp.success)if(0==resp.data.item_count)window.location.href=window.location.href;else{var $lineItem=$("#mp-cart-item-"+itemId.escapeSelector());0==$lineItem.siblings(".mp_cart_item").length&&$lineItem.closest(".mp_cart_store").length>0?$lineItem.closest(".mp_cart_store").remove():$lineItem.after(resp.data.cart_item_line).remove(),$("#mp-cart-resume").replaceWith(resp.data.cartmeta),marketpress.loadingOverlay("hide")}$(window).trigger("resize")})},mp_cart.undoRemoveItem=function(itemId){if(void 0===itemId)return!1;itemId=itemId.toString();var url=mp_cart_i18n.ajaxurl+"?action=mp_update_cart",data={product:itemId,cart_action:"undo_remove_item",is_cart_page:mp_cart_i18n.is_cart_page};marketpress.loadingOverlay("show"),$.post(url,data).done(function(resp){if(resp.success){var $lineItem=$("#mp-cart-item-"+itemId.escapeSelector());$lineItem.after(resp.data.cart_item_line).remove(),$("#mp-cart-resume").replaceWith(resp.data.cartmeta),marketpress.loadingOverlay("hide")}$(window).trigger("resize")})},mp_cart.emptyCart=function(){var url=mp_cart_i18n.ajaxurl+"?action=mp_update_cart",data={cart_action:"empty_cart"};$.post(url,data).done(function(resp){resp.success&&0==resp.data.item_count&&(window.location.href=window.location.href)})},mp_cart.update=function(html){$("#mp-floating-cart").replaceWith(html),this.initCartAnimation()},mp_cart.update_widget=function(html){$(".mp_cart_widget_content").html(html)},mp_cart.update_product_input=function(html,$form){$form.find("#mp_product_options_att_quantity-error").remove(),$(html).is("label")&&$form.find('[name="product_quantity"]').prev("label").remove(),$form.find('[name="product_quantity"]').after(html).remove()},mp_cart.update_product_buttons=function(out_of_stock,$form){out_of_stock===!0?$form.find(".mp_button").attr("disabled",!0):$form.find(".mp_button").attr("disabled",!1)},mp_cart.updateItemQty=function(itemId,qty,$scope){var url=mp_cart_i18n.ajaxurl+"?action=mp_update_cart",data={product:itemId,qty:qty,cart_action:"update_item",is_cart_page:mp_cart_i18n.is_cart_page};if(void 0===$scope)var $scope=$(document);marketpress.loadingOverlay("show"),$.post(url,data).done(function(resp){marketpress.loadingOverlay("hide"),marketpress.ajaxEvent("mp_cart/update_item_qty",resp,$scope),resp.success&&($.each(resp.data.product,function(key,val){var $item=$("#mp-cart-item-"+key);$item.replaceWith(val)}),$("#mp-cart-resume").replaceWith(resp.data.cartmeta),marketpress.initSelect2())})},mp_cart.initCartAnimation=function(){var $cart=$("#mp-floating-cart");$cart.hover(function(){$cart.addClass("in-transition"),setTimeout(function(){$cart.addClass("visible")},300)},function(){$cart.removeClass("visible in-transition")}).click(function(){$cart.addClass("in-transition"),setTimeout(function(){$cart.addClass("visible")},300)})}}(jQuery),jQuery(document).on("cbox_cleanup",function(){"undefined"!=typeof jQuery(".mp_select2").mp_select2&&jQuery(".mp_select2").mp_select2("close")}),jQuery(document).on("cbox_complete",function(){jQuery.colorbox.resize(),mp_cart.initCboxListeners()}),jQuery(document).ready(function($){mp_cart.init()});var mp_checkout;!function($){$.widget.bridge("mptooltip",$.ui.tooltip),mp_checkout={initListeners:function(){this.initShippingAddressListeners(),this.initAccountRegistrationListeners(),this.initPaymentOptionListeners(),this.initUpdateStateFieldListeners(),this.initCardValidation(),this.initCheckoutSteps(),this.listenToLogin(),$(document).on("mp_checkout/step_changed",this.lastStep)},initUpdateStateFieldListeners:function(){$('[name="billing[country]"], [name="shipping[country]"]').on("change",function(){var $this=$(this),url=mp_i18n.ajaxurl+"?action=mp_update_states_dropdown";if(0==$this.attr("name").indexOf("billing"))var $state=$('[name="billing[state]"]'),$zip=$('[name="billing[zip]"]'),type="billing",$row=$state.closest(".mp_checkout_fields");else var $state=$('[name="shipping[state]"]'),$zip=$('[name="shipping[zip]"]'),type="shipping",$row=$state.closest(".mp_checkout_fields");var data={country:$this.val(),type:type};$row.ajaxLoading("show"),$.post(url,data).done(function(resp){resp.success&&($row.ajaxLoading("false"),resp.data.states?($state.html(resp.data.states),$state.trigger("change").closest(".mp_checkout_column").show()):$state.closest(".mp_checkout_column").hide(),resp.data.show_zipcode?$zip.closest(".mp_checkout_column").show():$zip.closest(".mp_checkout_column").hide())})})},showForm:function(){$("#mp-checkout-form").show()},getHash:function(what,defaultVal){var hash=window.location.hash;if(void 0===defaultVal&&(defaultVal=!1),0>hash.indexOf("#!")||void 0===defaultVal)return defaultVal;var hashParts=hash.substr(2).split("&"),hashPairs={};return $.each(hashParts,function(index,value){var tmp=value.split("=");hashPairs[tmp[0]]=tmp[1]}),void 0===hashPairs[what]?defaultVal:hashPairs[what]},errorSummary:function(action,count){var $section=$(".mp_checkout_section").filter(".current").find(".mp_checkout_section_errors"),$checkout=$("#mp-checkout-form");if(void 0!==$checkout.data("mp-submitted"))if("show"==action){var errorVerb=count>1?mp_checkout_i18n.error_plural:mp_checkout_i18n.error_singular,errorString=mp_checkout_i18n.errors.replace("%d",count).replace("%s",errorVerb);$section.html(errorString).addClass("show")}else $section.removeClass("show")},lastStep:function(evt,$out,$in){var $checkout=$("#mp-checkout-form");0==$in.next(".mp_checkout_section").length?$checkout.addClass("last-step"):$checkout.removeClass("last-step")},nextStep:function(){var $current=$(".mp_checkout_section").filter(".current"),$next=$current.next(".mp_checkout_section");this.changeStep($current,$next)},changeStep:function($out,$in){$out.find(".mp_tooltip").mptooltip("close"),$out.find(".mp_checkout_section_content").slideUp(500,function(){$out.removeClass("current"),$in.find(".mp_checkout_section_content").slideDown(500,function(){$in.addClass("current"),$(document).trigger("mp_checkout/step_changed",[$out,$in]),mp_checkout.initActivePaymentMethod()})})},initCheckoutSteps:function(){var $checkout=$(" #mp-checkout-form");$.each($.validator.methods,function(key,val){$.validator.methods[key]=function(){if(arguments.length>0){var $el=$(arguments[1]),newVal=$.trim($el.val());$el.val(newVal),arguments[0]=newVal}return val.apply(this,arguments)}}),$checkout.find(".mp_checkout_section_heading-link").on("click",function(e){var $this=$(this),$section=$this.closest(".mp_checkout_section"),$current=$section.nextAll(".current");$current.length>0&&mp_checkout.changeStep($current,$section)}),$checkout.validate({rules:{shipping_method:"required"},onkeyup:!1,onclick:!1,ignore:function(index,element){return $(element).is(":hidden")||$(element).prop("disabled")},highlight:function(element,errorClass){$(element).addClass("mp_form_input_error").prev("label").addClass("mp_form_label_error")},unhighlight:function(element,errorClass,validClass){var $tip=$(element).siblings(".mp_tooltip");$tip.length>0&&$tip.mptooltip("close"),$(element).removeClass("mp_form_input_error").prev("label").removeClass("mp_form_label_error"),0==this.numberOfInvalids()&&mp_checkout.errorSummary("hide")},submitHandler:function(form){$checkout.data("mp-submitted",!0);var $form=$(form),$email=$form.find('[name="mp_login_email"]'),$pass=$form.find('[name="mp_login_password"]');if($form.valid()){var checkout_as_guest=!1;if($form.find("#is_checkout_as_guest").size()>0&&(checkout_as_guest=!0),$checkout.hasClass("last-step")){var gateway=$('[name="payment_method"]').filter(":checked").val();$(document).trigger("mp_checkout_process_"+gateway,[$form])}else if($.trim($email.val()).length>0&&$.trim($pass.val()).length>0&&0==checkout_as_guest){var $btn=$("#mp-button-checkout-login");$btn.ajaxLoading(),$("#mp-login-tooltip").length>0&&$("#mp-login-tooltip").remove();var data={action:"mp_ajax_login",email:$email.val(),pass:$pass.val(),mp_login_nonce:$form.find('[name="mp_login_nonce"]').val()};$.post(mp_i18n.ajaxurl,data).done(function(resp){resp.success?window.location.href=window.location.href:($btn.ajaxLoading("hide"),$email.before('<a id="mp-login-tooltip"></a>'),$("#mp-login-tooltip").mptooltip({items:"#mp-login-tooltip",content:resp.data.message,tooltipClass:"error",open:function(event,ui){setTimeout(function(){$("#mp-login-tooltip").mptooltip("destroy")},4e3)},position:{of:$email,my:"center bottom-10",at:"center top"},show:300,hide:300}).mptooltip("open"))})}else{var url=mp_i18n.ajaxurl+"?action=mp_update_checkout_data";marketpress.loadingOverlay("show"),$.post(url,$form.serialize()).done(function(resp){$.each(resp.data,function(index,value){$("#"+index).find(".mp_checkout_section_content").html(value)}),resp.data.mp_checkout_nonce&&$("input#mp_checkout_nonce").replaceWith(resp.data.mp_checkout_nonce),mp_checkout.initCardValidation(),marketpress.loadingOverlay("hide"),mp_checkout.nextStep()})}}},showErrors:function(errorMap,errorList){this.numberOfInvalids()>0&&mp_checkout.errorSummary("show",this.numberOfInvalids()),$.each(errorMap,function(inputName,message){var $input=$('[name="'+inputName+'"]'),$tip=$input.siblings(".mp_tooltip");0==$tip.length&&($input.after('<div class="mp_tooltip" />'),$tip=$input.siblings(".mp_tooltip"),$tip.uniqueId().mptooltip({content:"",items:"#"+$tip.attr("id"),tooltipClass:"error",show:300,hide:300})),$tip.mptooltip("option","content",message),$tip.mptooltip("option","position",{of:$input,my:"center bottom-10",at:"center top"}),$input.on("focus",function(){$input.hasClass("mp_form_input_error")}),$input.on("blur",function(){$tip.mptooltip("close")})}),this.defaultShowErrors()}})},initActivePaymentMethod:function(){var $input=$('input[name="payment_method"]');$input.filter(":checked").length?$input.filter(":checked").trigger("click"):$input.eq(0).trigger("click")},initCardValidation:function(){$(".mp-input-cc-num").payment("formatCardNumber"),$(".mp-input-cc-exp").payment("formatCardExpiry"),$(".mp-input-cc-cvc").payment("formatCardCVC"),$.validator.addMethod("cc-fullname",function(val,element){var pattern=/^([a-z]+)([ ]{1})([a-z]+)$/gi;return this.optional(element)||pattern.test(val)},mp_checkout_i18n.cc_fullname),$.validator.addMethod("cc-num",function(val,element){return this.optional(element)||$.payment.validateCardNumber(val)},mp_checkout_i18n.cc_num),$.validator.addMethod("cc-exp",function(val,element){var dateObj=$.payment.cardExpiryVal(val);return this.optional(element)||$.payment.validateCardExpiry(dateObj.month,dateObj.year)},mp_checkout_i18n.cc_exp),$.validator.addMethod("cc-cvc",function(val,element){return this.optional(element)||$.payment.validateCardCVC(val)},mp_checkout_i18n.cc_cvc)},initPaymentOptionListeners:function(){$(".mp_checkout_section").on("click change",'input[name="payment_method"]',function(){var $this=$(this),$target=$("#mp-gateway-form-"+$this.val()),$checkout=$("#mp-checkout-form"),$submit=$checkout.find(":submit").filter(":visible");$checkout.hasClass("last-step")&&($target.show().siblings(".mp_gateway_form").hide(),$target.find(".mp_form_input.error").filter(":visible").length>0?$checkout.valid():mp_checkout.errorSummary("hide"),void 0===$submit.data("data-mp-original-html")&&$submit.data("data-mp-original-html",$submit.html()),"true"==$this.attr("data-mp-use-confirmation-step")?$submit.html($submit.attr("data-mp-alt-html")):$submit.html($submit.data("data-mp-original-html")))}),this.initActivePaymentMethod()},toggleShippingAddressFields:function(){var $cb=$('input[name="enable_shipping_address"]'),$shippingInfo=$("#mp-checkout-column-shipping-info"),$billingInfo=$("#mp-checkout-column-billing-info");$cb.prop("checked")?($billingInfo.removeClass("fullwidth"),setTimeout(function(){$shippingInfo.fadeIn(500)},550)):$shippingInfo.fadeOut(500,function(){$billingInfo.addClass("fullwidth")})},toggleRegistrationFields:function(){var $cb=$('input[name="enable_registration_form"]'),$account_container=$("#mp-checkout-column-registration");$cb.prop("checked")?$account_container.fadeIn(500):$account_container.fadeOut(500)},initAccountRegistrationListeners:function(){var $enableRegistration=$('input[name="enable_registration_form"]');$enableRegistration.change(mp_checkout.toggleRegistrationFields)},initShippingAddressListeners:function(){var $enableShippingAddress=$('input[name="enable_shipping_address"]');$enableShippingAddress.change(mp_checkout.toggleShippingAddressFields),$('[name^="billing["]').on("change keyup",function(){if(!$enableShippingAddress.is(":checked")){var $this=$(this),name=$this.attr("name"),$target=$('[name="'+name.replace("billing","shipping")+'"]');0!=$target.length&&$target.val($this.val()).trigger("change")}})},triggerStepChange:function(){var $current=$(".mp_checkout_section").filter(".current");$(document).trigger("mp_checkout/step_changed",[$current,$current])},listenToLogin:function(){$(document).on("click",".mp_button-checkout-login",function(){$('input[name="mp_login_email"]').rules("add",{required:!0}),$('input[name="mp_login_password"]').rules("add",{required:!0});var form=$(this).closest("form");form.find("#is_checkout_as_guest").remove(),$(this).closest("form").submit()}),$(document).on("click",".mp_continue_as_guest",function(e){$('input[name="mp_login_email"]').rules("remove"),$('input[name="mp_login_password"]').rules("remove");var form=$(this).closest("form");0==form.find("#is_checkout_as_guest").size()&&form.append($('<input id="is_checkout_as_guest"/>')),$(this).closest("form").submit()}),$("#mp-checkout-form").on("keyup keypress",function(e){var code=e.keyCode||e.which;return 13==code?(e.preventDefault(),!1):void 0})}}}(jQuery),jQuery(document).ready(function($){mp_checkout.showForm(),mp_checkout.initListeners(),mp_checkout.toggleShippingAddressFields(),mp_checkout.toggleRegistrationFields(),mp_checkout.triggerStepChange()}),function($){$.fn.equalHeights=function(){var maxHeight=0;return this.each(function(){maxHeight=Math.max($(this).height(),maxHeight)}),this.each(function(){$(this).height(maxHeight)})}}(jQuery),function($){$("<img>").get(0).src=mp_i18n.loadingImage,$.fn.ajaxLoading=function(action){if("undefined"==typeof action)var action="show";return this.each(function(){"show"==action?$(this).hide().after('<img src="'+mp_i18n.loadingImage+'" alt="">'):$(this).show().next("img").remove()})}}(jQuery);var marketpress={};!function($){$.widget.bridge("mptooltip",$.ui.tooltip),$(window).resize(function(){$("#mp-products.mp_products-grid").each(function(){var $this=$(this);$this.find(".mp_product_meta").equalHeights()}),$("#mp-related-products .mp_products-grid .mp_product_meta").each(function(){var $this=$(this);$this.find(".mp_product_meta").equalHeights()})}),marketpress={loadingOverlay:function(action){var $overlay=$($("#colorbox").is(":visible")?"#cboxLoadingOverlay":"#mp-loading-overlay");if(void 0===action)var action="show";switch(0==$overlay.length&&($("body").append('<div id="mp-loading-overlay" style="display:none"></div>'),$overlay=$("#mp-loading-overlay")),action){case"show":$overlay.show();break;case"hide":$overlay.hide()}},initToolTips:function(){$(document).mptooltip({items:".mp_tooltip-help, .mp_tooltip",content:function(){var $this=$(this);return $this.is(".mp_tooltip")&&($this=$this.next(".mp_tooltip_content")),$this.html()},position:{my:"center bottom-10",at:"center top"},hide:300,show:300,tooltipClass:"mp_tooltip-opened"})},equalizeProductGrid:function(){$("#mp-products.mp_products-grid").each(function(){var $this=$(this);$this.find(".mp_product_meta").equalHeights()}),$("#mp-related-products .mp_products-grid").each(function(){var $this=$(this);$this.find(".mp_product_meta").equalHeights()})},getViewportSize:function(){function setMiniCartMaxHeight(){var viewportHeight=$(window).height(),miniCart=$("#mp-floating-cart"),miniCartRibbon=miniCart.find(".mp_mini_cart_ribbon"),miniCartRibbonHeight=miniCartRibbon.height(),miniCartContent=miniCart.find(".mp_mini_cart_content"),miniCartContentHeight=miniCartContent.height(),miniCartHeight=miniCartRibbonHeight+miniCartContentHeight,miniCartMaxHeight=viewportHeight-2*miniCartRibbonHeight-100;(miniCartHeight>viewportHeight||miniCartHeight>miniCartMaxHeight)&&miniCart.each(function(){var $this=$(this);$this.find(".mp_mini_cart_items").css({"margin-top":"50px"}),$this.find(".mp_button-mini-cart").css({position:"absolute",top:"15px",left:0,right:0,margin:"auto 30px"})}),miniCartContent.css({"max-height":miniCartMaxHeight+"px"})}setMiniCartMaxHeight(),$(window).on("resize",function(){setMiniCartMaxHeight()})},initSelect2:function(){$("select.mp_select2").not(".select2-offscreen").mp_select2({dropdownCssClass:"mp_select2",dropdownAutoWidth:1,minimumResultsForSearch:-1}),$("select.mp_select2_search").not(".select2-offscreen").mp_select2({dropdownCssClass:"mp_select2",dropdownAutoWidth:1})},initOrderLookup:function(){var $form=$("#mp-order-lookup-form"),$btn=$form.find('[type="submit"]'),$input=$form.find('input[type="text"]');$form.on("submit",function(e){if(e.preventDefault(),!$btn.is(":hidden")){var data=$form.serialize();$btn.ajaxLoading("show"),$input.prop("disabled",!0),$.post($form.attr("action"),data).done(function(resp){if(resp.success)window.location.href=resp.data.redirect_url;else{var $tooltip=$input.prev(".mp_tooltip");$btn.ajaxLoading("hide"),$input.prop("disabled",!1),0==$tooltip.length&&($input.before('<div class="mp_tooltip"></div>'),$tooltip=$input.prev(".mp_tooltip"),$tooltip.mptooltip({items:".mp_tooltip",tooltipClass:"error",position:{of:$input,my:"center bottom-10",at:"center top"},hide:300,show:300})),$tooltip.mptooltip("option","content",resp.data.error_message),$tooltip.mptooltip("open")}})}})},initProductTabs:function(){if($("body").on("click",".mp_product_meta a.more-link",function(e){e.preventDefault(),$(".mp-single-product a.mp_product_tab_label_link.mp-product-overview").click(),$("html, body").animate({scrollTop:$("a.mp_product_tab_label_link.mp-product-overview").offset().top-30},500)}),$(".mp_product_tab_label_link").click(function(e){e.preventDefault();var $this=$(this),$tab=$this.parent(),$target=$($this.attr("href"));$tab.addClass("current").siblings().removeClass("current"),$target.addClass("mp_product_tab_content-current").siblings(".mp_product_tab_content").removeClass("mp_product_tab_content-current")}),window.location.hash.length>0){var $target=$('[href="'+window.location.hash+'"]');$target.length>0&&$target.trigger("click")}},ajaxEvent:function(event,resp,$scope){if(void 0===$scope)var $scope=$(document);var successEvent=event+"/success",errorEvent=event+"/error";if($scope.trigger(event,[resp]),resp.success)$scope.trigger(successEvent.replace("//","/"),[resp.data]);else{var message=void 0===resp.data?"":resp.data.message;$scope.trigger(errorEvent.replace("//","/"),[message])}},initImageLightbox:function(){$(".mp_product_image_link").filter(".mp_lightbox").colorbox({maxWidth:"90%",maxHeight:"90%",close:"&times;"})},initProductFiltersPagination:function(){var $form=$("#mp-products-filter-form");$form.on("change","select",function(e){var $this=$(this);if("product_category"==$this.attr("name")){var val=$this.val();return marketpress.loadingOverlay("show"),void("undefined"==typeof mp_i18n.productCats[val]?window.location.href=mp_i18n.productsURL:window.location.href=mp_i18n.productCats[val])}marketpress.updateProductList()})},updateProductList:function(){var $form=$("#mp-products-filter-form"),data=$form.serialize(),url=mp_i18n.ajaxurl+"?action=mp_update_product_list";marketpress.loadingOverlay("show"),$.post(url,data).done(function(resp){marketpress.loadingOverlay("hide"),$(".mp_listings_nav").remove(),$("#mp-products").replaceWith(resp),mp_cart.initCartListeners()})},unserialize:function(str){if(str.indexOf("?")>=0){var strParts=str.split("?");str=strParts[1]}var dataPairs=str.split("&"),obj={};return $.each(dataPairs,function(index,value){var tmp=value.split("=");obj[tmp[0]]=tmp[1]}),obj},initGlobalProductFiltersPagination:function(){var $form=$("#mp_global_product_list_refine");$form.on("change","select",function(e){var $this=$(this);if("product_category"==$this.attr("name")){var val=$this.val();return marketpress.loadingOverlay("show"),void("undefined"==typeof mp_global.cat_urls[val]?window.location.href=mp_global.cat_url:window.location.href=mp_global.cat_urls[val])}marketpress.updateGlobalProductList()})},updateGlobalProductList:function(){var $form=$("#mp_global_product_list_refine"),data=$form.serialize(),url=mp_i18n.ajaxurl+"?action=mp_global_update_product_list";marketpress.loadingOverlay("show"),$.post(url,data).done(function(resp){marketpress.loadingOverlay("hide"),$(".mp_listings_nav").remove(),$(".mp_global_product_list_widget .mp_products").replaceWith(resp),mp_cart.initCartListeners()})}}}(jQuery),jQuery(document).ready(function(){marketpress.initSelect2(),marketpress.initProductTabs(),marketpress.initToolTips(),marketpress.initOrderLookup(),marketpress.initImageLightbox(),marketpress.initProductFiltersPagination(),marketpress.initGlobalProductFiltersPagination(),marketpress.getViewportSize()}),window.onload=function(){marketpress.equalizeProductGrid()};